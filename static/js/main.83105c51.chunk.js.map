{"version":3,"sources":["components/GetImgurImg.js","components/FilterListItem.js","WP.png","components/CamanCanvas.js","App.js","index.js"],"names":["httpsRequest","params","postData","Promise","resolve","reject","req","https","request","res","statusCode","Error","body","on","chunk","push","JSON","parse","Buffer","concat","toString","err","write","end","getImgBlob","imageUrl","imgId","a","fetch","response","blob","data","name","getImg","imageId","setImgData","process","then","results","catch","console","error","getAlbum","albumId","images","id","resetValue","event","init","onChange","target","value","attributes","FilterListItem","filter","range","filterList","min","max","step","curValue","className","onClick","type","caman","window","Caman","PresetButton","preset","presetName","active","buttonRef","useRef","myButton","current","bsButton","Button","getInstance","toggle","ref","CreatePresetList","presetList","presetsPretty","buttonList","entries","index","isActive","createFilterList","rangeList","rangeFull","rangeHalf","filters","isRendering","prevRenderList","curRenderList","backlog","updateImgFn","throttledEventListen","throttle","Event","listen","job","stringify","htmlCanvas","image","this","render","CamanCanvas","useState","setPresetList","setFilterList","adjustmentList","setAdjustmentList","presetToggle","setPresetToggle","filename","setFilename","imgurImgData","setImgurImgData","editPaneRef","imgurUrlRef","updateImage","throttled","useEffect","newList","log","revert","setImage","file","reader","FileReader","readAsDataURL","onload","img","Image","src","result","canvas","firstChild","context","getContext","width","height","drawImage","removeAttribute","updateCanvas","form","regex","album","test","split","substring","match","link","alt","htmlFor","placeholder","aria-labelledby","required","accept","files","newFilename","document","createElement","download","href","toDataURL","e","MouseEvent","dispatchEvent","parseFloat","data-bs-target","data-bs-toggle","currentPresets","App","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.83105c51.chunk.js","sourcesContent":["import https from 'follow-redirects/https';\n// const fs = require('fs');\n\nfunction httpsRequest(params, postData) {\n  return new Promise(function (resolve, reject) {\n    var req = https.request(params, function (res) {\n\n      // reject on bad status\n      if (res.statusCode < 200 || res.statusCode >= 300) {\n        return reject(new Error('Status Code ' + res.statusCode));\n      }\n\n      // cumulate data\n      var body = [];\n      res.on('data', function (chunk) {\n        body.push(chunk);\n      });\n\n      // resolve on end\n      res.on('end', function () {\n        try {\n          body = JSON.parse(Buffer.concat(body).toString());\n        } catch (err) {\n          reject(err);\n        }\n        resolve(body);\n      });\n    });\n\n    // reject on request error\n    req.on('error', function (err) {\n      reject(err);\n    });\n\n    if (postData) {\n      req.write(postData);\n    }\n\n    req.end();\n  });\n}\n\nexport async function getImgBlob(imageUrl, imgId) {\n  if (imageUrl) {\n    let response = await fetch(imageUrl);\n    let data = await response.blob();\n    data.name = imgId;\n\n    return data;\n  }\n}\n\nexport function getImg(imageId, setImgData) {\n\n  const options = {\n    'method': 'GET',\n    'hostname': 'api.imgur.com',\n    'path': `/3/image/${imageId}`,\n    'headers': {\n      'Authorization': `Client-ID ${process.env.REACT_APP_CLIENTID}`\n    },\n    'maxRedirects': 20\n  };\n\n  httpsRequest(options)\n    .then((results) => (setImgData(results.data)))\n    .catch((err) => console.error(err));\n}\n\nexport function getAlbum(albumId) {\n\n  const options = {\n    'method': 'GET',\n    'hostname': 'api.imgur.com',\n    'path': `/3/album/${albumId}`,\n    'headers': {\n      'Authorization': `Client-ID ${process.env.REACT_APP_CLIENTID}`\n    },\n    'maxRedirects': 20\n  };\n\n  return httpsRequest(options)\n    .then((results) => { return results.data.images[0].id; })\n    .catch((err) => console.error(err));\n}\n","const resetValue = (event, init, onChange) => {\n  event.target.value = init;\n  event.target.name = event.target.attributes.name.value;\n  onChange(event, init);\n}\n\nconst FilterListItem = ({ filter, range, filterList, onChange }) => {\n  const min = range[\"min\"] != null ? range[\"min\"] : -100;\n  const max = range[\"max\"] != null ? range[\"max\"] : 100;\n  const step = range[\"step\"] || 1;\n  const init = range[\"init\"] || 0;\n  const curValue = (filterList[filter] != null) ? filterList[filter] : init;\n\n  return (\n    <div className=\"col\">\n      <div className=\"row gx-1 hover\">\n\n        <label name={filter} className=\"col-3 reset\"\n          onClick={(event) => resetValue(event, init, onChange)}>{filter}</label>\n\n        <div className=\"col-8\">\n          <input id={filter} name={filter} className=\"form-range slider\"\n            type=\"range\" min={min} max={max} step={step}\n            value={curValue} onChange={(event) => onChange(event, init)} />\n        </div>\n\n        <span name={filter} className=\"col-1 reset\"\n          onClick={(event) => resetValue(event, init, onChange)}>{curValue}</span>\n\n      </div>\n    </div>\n  );\n};\n\nexport default FilterListItem;\n","export default __webpack_public_path__ + \"static/media/WP.394371ca.png\";","import { useState, useEffect, useRef } from 'react';\nimport { Button } from 'bootstrap';\nimport throttle from 'lodash/throttle';\n\nimport { getImg, getImgBlob, getAlbum } from './GetImgurImg'\nimport FilterListItem from './FilterListItem'\nimport image from './../WP.png'\n// import image from './../142.jpg'\n\n// import usePrevious from './usePrevious'\nconst caman = window.Caman;\n\n\n// TO DO:\n// channels {red: [-100,100], green: [-100,100], blue:[-100:100]}\n// stackBlur [0, 20]?\n// colorize [R,G,B, [0-100]] || ['#eee', [0-100]]\n// curves [[R,G,B], [P0x,P1x], [P2], [P3], [P4]]\n// fillColor [R,G,B] || ['#eee']\n// Greyscale(), Invert()\n\n// Stage 2\n// Crop, Resize, Preset strength, undo/redo\n// vignette, rectangularVignette, tiltShift, radialBlur,\n// boxBlur?, heavyRadialBlur, gaussianBlur, motionBlur,\n// edgeEnhance, edgeDetect, emboss, posterize,\n\n\n// To Do: Change list of presets to include pretty names\nfunction PresetButton({ preset, presetName, onClick, active }) {\n  const buttonRef = useRef();\n\n  var myButton = buttonRef.current\n  var bsButton = Button.getInstance(myButton)\n\n  if (!bsButton) { bsButton = new Button(myButton, { toggle: \"button\" }) }\n\n  return (\n    <div className=\"col p-1 d-grid\">\n      <button className={`btn btn-primary ${active ? 'active' : null}`} ref={buttonRef} id={preset}\n        onClick={(event) => { onClick(event) }} type=\"button\">\n        {`${presetName}`}\n      </button>\n    </div>\n  )\n}\n\nfunction CreatePresetList({ presetList, onClick }) {\n  const presets = [\n    \"vintage\", \"lomo\", \"clarity\", \"sinCity\", \"sunrise\", \"crossProcess\", \"orangePeel\",\n    \"love\", \"grungy\", \"jarques\", \"pinhole\", \"oldBoot\", \"glowingSun\",\n    \"hazyDays\", \"herMajesty\", \"nostalgia\", \"hemingway\", \"concentrate\"\n  ];\n\n  const presetsPretty = [\n    \"Vintage\", \"Lomo\", \"Clarity\", \"Sin City\", \"Sunrise\", \"Cross Process\", \"Orange Peel\",\n    \"Love\", \"Grungy\", \"Jarques\", \"Pinhole\", \"Old Boot\", \"Glowing Sun\",\n    \"Hazy Days\", \"Her Majesty\", \"Nostalgia\", \"Hemingway\", \"Concentrate\"\n  ];\n\n  let buttonList = []\n  for (const [index, preset] of presets.entries()) {\n    let isActive = presetList[preset] ? true : false\n    buttonList.push(\n      <PresetButton key={preset} preset={preset} presetName={presetsPretty[index]}\n        onClick={onClick} active={isActive} />\n    )\n  }\n  return buttonList;\n}\n\nfunction createFilterList(filterList, onChange) {\n  // -100 to 100\n  const filtersFullRange = [\"brightness\", \"contrast\", \"vibrance\", \"saturation\", \"exposure\"];\n  // 0 to 100\n  const filtersHalfRange = [\"hue\", \"sepia\", \"noise\", \"sharpen\", \"clip\"];\n  const filtersSpecial = { \"gamma\": { \"min\": 0, \"init\": 1, \"max\": 10, \"step\": 0.1 } };\n\n  let rangeList = {}\n\n  const rangeFull = { \"min\": -100, \"init\": 0, \"max\": 100 }\n  // Must be for...of; for...in replaces names with indicies\n  for (const filter of filtersFullRange) { rangeList[filter] = rangeFull; }\n\n  const rangeHalf = { \"min\": 0, \"init\": 0, \"max\": 100 }\n  for (const filter of filtersHalfRange) { rangeList[filter] = rangeHalf; }\n  rangeList = { ...rangeList, ...filtersSpecial };\n\n  let filters = [];\n  // Must be for...in, rangeList isn't iterable\n  for (const filter in rangeList) {\n    filters.push(\n      <FilterListItem key={filter} filter={filter} range={rangeList[filter]}\n        filterList={filterList} onChange={onChange} />\n    )\n  }\n\n  return filters;\n}\n\n\nlet isRendering = false;\nlet prevRenderList = {}, curRenderList = {};\nlet backlog = 0;\nlet updateImgFn = () => { };\nconst throttledEventListen = throttle((curRenderList) => (updateImgFn(curRenderList)), 1000);\n\ncaman.Event.listen(\"processStart\", function (job) {\n  // console.log(\"Start:\", job.name);\n  isRendering = true;\n});\n\ncaman.Event.listen(\"processComplete\", function (job) {\n  // console.log(\"Finish:\", job.name);\n  isRendering = false;\n  backlog = 0;\n  if (JSON.stringify(prevRenderList) !== JSON.stringify(curRenderList)) {\n    // console.log(\"Updating from prev render\", prevRenderList, curRenderList)\n    // updateImgFn(curRenderList);\n    throttledEventListen(curRenderList);\n  }\n});\n\n\n// window.Caman.DEBUG = true\nlet htmlCanvas = \"#canvas\";\ncaman(htmlCanvas, image, function () {\n  this.render();\n});\n\nconst CamanCanvas = () => {\n  const [presetList, setPresetList] = useState({});\n  const [filterList, setFilterList] = useState({});\n  const [adjustmentList, setAdjustmentList] = useState({});\n  const [presetToggle, setPresetToggle] = useState(false);\n  const [filename, setFilename] = useState(\"\");\n  const [imgurImgData, setImgurImgData] = useState({});\n  const editPaneRef = useRef(null);\n  const imgurUrlRef = useRef(null);\n\n  updateImgFn = updateImage;  // Save function so Caman Event listener can call it\n\n\n  // Throttled could take an options object, but it appears to work fine with default\n  const throttled = useRef(throttle((adjustmentList) => (updateImage(adjustmentList)), 100));\n  // const prevList = usePrevious(adjustmentList);\n\n  /* Update the image after our adjustments change */\n  useEffect(() => {\n    // if (JSON.stringify(prevList) !== JSON.stringify(adjustmentList)) {\n    if (JSON.stringify(prevRenderList) !== JSON.stringify(adjustmentList)) {\n\n      if (!isRendering) {\n        if (backlog) {\n          isRendering = true;\n        }\n        // console.log(\"Throttle rendering with\", adjustmentList, backlog);\n        throttled.current(adjustmentList);\n        backlog += 1;\n      }\n      // else {\n      //   console.log(\"Skipped, rendering\");\n      // }\n\n    }\n  }, [adjustmentList]);\n\n  /* Combine presets and filters into master adjustment list */\n  useEffect(() => {\n    const newList = { ...presetList, ...filterList }\n    setAdjustmentList(curRenderList = newList);\n  }, [filterList, presetList]);\n\n\n  /* Sliders Callback */\n  const updateFilters = (event, init) => {\n    const filter = event.target.name;\n    const value = parseFloat(event.target.value);\n    console.log(\"Updating\", filter);\n\n    let newList;\n    if (value === init) {\n      // console.log(`Reset ${filter} to default`)\n      newList = { ...filterList };\n      delete newList[filter];\n    } else {\n      newList = { ...filterList, [filter]: value };\n    }\n\n    // if (JSON.stringify(newList) !== JSON.stringify(filterList)) {\n    setFilterList(newList);\n    // }\n  }\n\n  /* Button Callback */\n  const updatePresets = (event) => {\n    const preset = event.target.id;\n\n    // console.log(\"Updating preset\", preset);\n\n    let currentPresets = {};\n    if (!presetList[preset]) { currentPresets[preset] = 1; }\n\n    setPresetList(currentPresets);\n  }\n\n  function updateImage(adjustmentList) {\n    prevRenderList = adjustmentList;\n    caman(htmlCanvas, function () {\n      console.log(\"~~~~ UPDATE IMAGE ~~~~\")\n      console.log(adjustmentList)\n\n      this.revert(false);\n      for (const filter in adjustmentList) {\n\n        if (this[filter]) {\n          this[filter](adjustmentList[filter]);\n        } else {\n          console.log(`${filter} is not a valid filter.`);\n          let newList = { ...adjustmentList };\n          delete newList[filter];\n          // Invalid filters will usually be at the end of the list because they get removed each render\n          // So we can just render and it will look okay until the updated re-render\n          this.render();\n          setAdjustmentList(newList);\n          return;\n        }\n      }\n      this.render();\n    });\n  }\n\n\n  /* Presets toggle button */\n  function toggleCollapse() {\n    setPresetToggle(!presetToggle);\n  }\n\n  /* Take an image object and update the canvas */\n  function updateCanvas(img) {\n    let parent = editPaneRef.current;\n    let canvas = parent.firstChild;\n    let context = canvas.getContext(\"2d\");\n\n    canvas.width = img.width;\n    canvas.height = img.height;\n    context.drawImage(img, 0, 0, img.width, img.height);\n    canvas.removeAttribute(\"data-caman-id\");\n\n    updateImage(adjustmentList);\n  }\n\n  /* Read a file and upate the canvas */\n  function setImage(file) {\n    const reader = new FileReader();\n    if (file) {\n      setFilename(file.name);\n      // read data as URL\n      reader.readAsDataURL(file);\n    }\n\n    reader.onload = () => {\n      let img = new Image();\n      img.src = reader.result;\n\n      img.onload = () => { updateCanvas(img); };\n    };\n  }\n\n\n  /* Take the file from the file browser and set it */\n  function uploadFile(event) {\n    const file = event.target.files[0];\n    setImage(file);\n  }\n\n\n  function downloadImage() {\n\n    let newFilename = filename ? (\"carmen-edited_\" + filename) : \"carmen-edited.jpg\"\n    console.log(\"Boop! Downloading\", newFilename);\n\n    let parent = editPaneRef.current;\n    let canvas = parent.firstChild;\n\n    // create link\n    const link = document.createElement(\"a\");\n    link.download = newFilename;\n    link.href = canvas.toDataURL(\"image/jpeg\", 1);\n    let e = new MouseEvent(\"click\");\n    link.dispatchEvent(e);\n  }\n\n\n  async function importImgur() {\n    let form = imgurUrlRef.current;\n    let value = form.value;\n\n    // imageID is 7 chars long\n    const regex = /\\w{7}/g\n    const album = /\\/gallery\\/|\\/a\\//g\n\n    let imgId;\n    if (album.test(value)) {\n      imgId = value.split(album)[1];\n      imgId = imgId.substring(0, 7)  // In case anything is after the id\n\n      // Do album look up to get real cover imgId\n      imgId = await getAlbum(imgId);\n      console.log(imgId);\n\n    } else if (regex.test(value)) {\n      imgId = value.match(regex)[0];\n      console.log(imgId);\n\n    } else { return; }\n\n    // Get imgId URL and update canvas\n    try {\n      getImg(imgId, setImgurImgData);\n    } catch (error) {\n      console.error(error);\n    }\n\n  }\n\n  useEffect(() => {\n    getImgBlob(imgurImgData.link, imgurImgData.id)\n      .then(result => setImage(result))\n      .catch((err) => console.error(err));\n  }, [imgurImgData]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  function exportImgur() {\n    console.log(\"Export\")\n  }\n\n  return (\n    <>\n      <div id=\"editPane\" ref={editPaneRef} className=\"edit-pane bg-gray container-lg text-center p-4 lh-1\">\n        <img id=\"canvas\" alt=\"Editing Canvas\" className=\"img-fluid\" src={image} />\n      </div>\n\n      <div className=\"row my-3 d-flex align-items-end\">\n        <div className=\"col\">\n          <label htmlFor=\"formImgur\" className=\"form-label\">Import Image from or Upload to Imgur</label>\n          <input className=\"form-control\" id=\"formImgur\" ref={imgurUrlRef} type=\"text\"\n            placeholder=\"https://imgur.com/...\" aria-labelledby=\"formImgur\" required />\n        </div>\n        <div className=\"col col-auto text-center ps-0\">\n          <button id=\"downloadImage\" className=\"btn btn-primary\" type=\"submit\" onClick={importImgur}>\n            <i className=\"d-block d-md-none bi bi-cloud-download\" />\n            <span className=\"d-none d-md-block\">Import from Imgur</span>\n          </button>\n        </div>\n        <div className=\"col col-auto text-center ps-0\">\n          <button id=\"downloadImage\" className=\"btn btn-primary\" onClick={exportImgur}>\n            <i className=\"d-block d-md-none bi bi-cloud-upload\" />\n            <span className=\"d-none d-md-block\">Upload to Imgur</span>\n          </button>\n        </div>\n      </div>\n\n      <div className=\"row my-3 d-flex align-items-end\">\n        <div className=\"col\">\n          <label htmlFor=\"formFile\" className=\"form-label\">Upload Image from Device</label>\n          <input className=\"form-control\" type=\"file\" id=\"formFile\" accept=\"image/*\"\n            aria-labelledby=\"formFile\" onChange={uploadFile} />\n        </div>\n        <div className=\"col col-auto text-center ps-0\">\n          <button id=\"downloadImage\" className=\"btn btn-primary\" onClick={downloadImage}>\n            <i className=\"d-block d-md-none bi bi-download\" />\n            <span className=\"d-none d-md-block\">Download Image</span>\n          </button>\n        </div>\n      </div>\n\n      <div id=\"filterHolder\">\n        <div id=\"filterList\" className=\"container overflow-hidden bg-dark text-center my-3 p-2\">\n\n          <div className=\"row row-cols-1 row-cols-md-2 center\">\n            {createFilterList(filterList, updateFilters)}\n          </div>\n\n          <hr />\n          <div className=\"py-2\">\n            <button className=\"btn btn-primary\" onClick={toggleCollapse} data-bs-target=\"#collapseTarget\" data-bs-toggle=\"collapse\">\n              <i className={\"px-2 bi \" + (presetToggle ? \"bi-chevron-compact-up\" : \"bi-chevron-compact-down\")}></i>\n              Presets\n              <i className={\"px-2 bi \" + (presetToggle ? \"bi-chevron-compact-up\" : \"bi-chevron-compact-down\")}></i>\n            </button>\n            <div className=\"collapse pt-2\" id=\"collapseTarget\">\n              <div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-6 m-1\">\n                <CreatePresetList presetList={presetList} onClick={updatePresets} />\n              </div>\n            </div>\n          </div>\n\n        </div>\n      </div>\n\n    </>\n  );\n}\n\nexport default CamanCanvas;\n","import CamanCanvas from './components/CamanCanvas'\n\nfunction App() {\n\n  return (\n    <div className=\"App container text-light\">\n\n      <div className=\"bg-dark px-4 py-1 my-3\">\n        <h1 className=\"text-primary display-2\">\n          <i className=\"bi bi-image-fill\"></i> Carmen\n        </h1>\n        <div>\n          Caman + React <span className=\"vertical-line\"> </span>\n          Browser Based Image Editing <span className=\"vertical-line\"> </span>\n          <a href=\"http://camanjs.com/\">CamanJS</a> <span className=\"vertical-line\"> </span>\n          <a href=\"https://github.com/Martination/carmen\">\n            GitHub Repo</a>\n        </div>\n      </div>\n\n      <CamanCanvas />\n\n      <div className=\"text-center pb-3\">\n        &#169; 2021 <a href=\"https://martination.github.io/\">Martin Green</a>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./custom.scss\";\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}